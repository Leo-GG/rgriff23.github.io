---
title: "Mosquito community diversity analysis (vegan)"
layout: post
date: 2017-04-xx
tags: R ecology tutorial
---

In this tutorial, I demonstrate how to use the R package [`vegan`](https://cran.r-project.org/web/packages/vegan/index.html) to analyze an original dataset on the abundance of mosquito species in the Raleigh-Durham area of North Carolina. This tutorial is based on the analysis I performed for [this paper](/assets/pdfs/Reiskind_etal_2016.pdf) in collaboration with the [Reiskind lab](http://vectorecology.org/) at NC State University. 

## Study design

We selected three regions in the Raleigh-Durham area of NC. Within each region, we identified 3 200m transects that spanned a field-forest habitat gradient. At each site we set up 5 traps along the transect, with the field-forest boundary located at the 100m mark. Altogether, this study design resulted in 45 trap locations (3 regions x 3 transects x 5 trap locations). Each trap was labeled based on it's position along the transect: far-field, near-field, edge, near-forest, or far-forest. 

Using 6-inch ground resolution imagery from the <a target="_blank" href="http://earthexplorer.usgs.gov/">USGS Earth Explorer</a>, we digitally classified the landscape within 100 meters of each trap into 8 categories: grassland, deciduous tree canopy, evergreen tree canopy, mixed tree canopy, shrub, cultivated crops, barren land, pavement, and buildings. 

To collect mosquitoes, <a target="_blank" href="http://johnwhock.com/products/mosquito-sandfly-traps/cdc-miniature-light-trap/">CDC light traps</a> were hung on T-shaped structures built from PVC pipes. Traps were baited with dry ice because host-seeking mosquitoes are drawn to carbon dioxide. Here is what our trap set-up looked like:

![](./mosquitoes/MosquitoTrap.jpg)

Traps were set up at dusk and picked up at dawn. Once traps were collected, mosquitoes were taken back to the lab and killed in a freezer before being identified to species level and counted. Collection at each trap took place once every 2 weeks over a 5 month period from June 1 to October 15, 2014. 

## The data

Two separate data files are needed for this analysis: 

1) **Species abundance** in the form of a site x species matrix, where each cell of the matrix corresponds to the number of specimens that were captured for a given species at a given trap location For example, in the following site x species matrix, 2340 specimens of species A were captured at trap A:
```{r, include=FALSE}
# make up a site x species matrix
```
2) **Environmental variables** in the form of a data frame, where each column corresponds to an environmental variable and each row corresponds to a trap location, like this:
```{r, include=FALSE}
# make up an environmental variable dataframe 
```

Let's open R and load the packages we will need for this analysis (please install them first if you haven't already):

```{r, message=FALSE}
# load packages
library(vegan)
library(data.table) # for reading in data from GitHub
```

Using the `read?` function from the `data.table` package, read the two data files into R.

```{r}
# read abundance data
# read environmental data
```

Take a few minutes to familiarize yourself with the data. The abundance data is a 45 x 23 matrix, with the 45 rows corresponding to the 45 trap locations, and the 23 columns corresponding to 23 different species that were caught over the course of the summer. The environmental data frame also contains 45 rows corresponding to the 45 trap locations, and X columns corresponding the the X environemntal variables that were collected from each trap location. 

Before starting our analysis, we will make one modification to the data. It is recommended to [square root transform]() species abundance data to reduce the impact of the occasional very large count on our results. So let's apply a square root transformation to our abundance matrix:

```{r}
abundance <- sqrt(matrix)
```
 
Now on to analysis!
 
## Comparing community diversity measures across habitat types

To begin, we will compute three different measures of community diversity for each trap site:

1. Richness, the total number of unique species found at a site
2. Shannon-Weiner diversity, a common diversity index where species are weighted by abundance (Magurran 2004)
3. Rarefied richness, or species richness estimated with a resampling procedure to control for variation in sample size (Hurlbert 1971; Heck et al. 1975)

Some thoughts about these metrics

We then used ANOVA to assess whether community diversity metrics change along transects. In other words, does community diversity vary along the field-forest habitat gradient? Here are boxplots depicting our measures of mosquito community diversity across different habitats:

![](./mosquitoes/Evenness.png)

Our analysis reveals that mosquito community diversity is higher in forested habitat than field habitat. We found that species richness and rarefied richness were both significantly associated with habitat type (*p* < 0.05), while Shannon-Weiner diversity approached significance (*p* < 0.07).

## Identifying major axes of variation in community composition

In this section we will perform an exploratory [ordination analysis](https://en.wikipedia.org/wiki/Ordination_(statistics)), which will help us identify 1) which collection sites are most similar in terms of their composition of mosquito species, and 2) which mosquito species are most similar in terms of their distribution across collection sites. 

## Closing thoughts

Our analysis shows that forests tended to have greater mosquito species diversity than fields. In addition, the dominant predictor of mosquito community composition is a tree density gradient, with regional differences playing a secondary role. Thus, mosquito communities within 100m of each other in adjacent field and forest habitats are more dissimilar than mosquito communities occupying similar habitats that are separated by many miles. 

# ####################################################################################
# ####################################################################################
# ####################################################################################

The next question we asked was whether the composition of mosquito communities tends to be similar within habitat types. Since groups of transects were separated by many miles, it is conceivable that mosquito communities would be more similar within transects than within habitat types. For example, it could be that the mosquito communities of adjacent field and forest habitats are more similar than the communities of two forest habitats that are spaced many miles apart. However, if local habitat type strongly predicts which mosquito species are present, than mosquito communities in distant but similar habitats may be more similar than adjacent communities in different habitats.

To address this question, we used partial canonical correspondence analysis (pCCA), which is a multivariate ordination technique that identifies major axes of variation in a multivariate dataset, with the contraint that those axes must be linear combinations of explanatory variables (Ter Braak 1987). A Site X Species matrix of abundance data was treated as the response variable, while landscape variables for sites were used as explanatory variables. An advantage of pCCA is that ecological variables that are not of direct interest can be "partialled out", allowing researchers to control for potentially influential factors while focusing on variables of interest. We focused on variables related to the extent to which habitats represented field or forest (percent of Deciduous Forest, Evergreen Forest, Mixed Forest, Grassland, and Shrub), and partialled out variables related to human land use (percent of BarrenLand, Buildings, Cultivated Crops, and Pavement). Here are pCCA plots depicting the positions of mosquito species and sites relative to the major axes of variation in our dataset:

![](./mosquitoes/pCCA.png)

Our pCCA results indicated that the major factor predicting mosquito community composition is a tree density gradient: landscapes with similar amounts of tree cover have similar mosquito communities (CCA 1). The second major factor predicting mosquito community composition reflected differences across transect locations, with Durham sites segregating from Lake Wheeler and Prarie Ridge sites (CCA 2). These differences may be related to the type of field (grassland vs. shrub) and forest (deciduous vs. evergreen) habitats that were prevalent at those sites. All together, our environmental variables explained 33.63% of total variation in mosquito community composition (*p* < 0.001), and the first two pCCA axes accounted for 84.08% of that variation. 

