---
title: "Orbit orientation isn't correlated with anything: a reanalysis of Heesy 2005 (ape, geiger, geomorph, ggtree)"
layout: post
date: 2017-06-xx
category: post-publication-peer-review
tags: R evolution primates morphology phylogeny GLMM ape geiger geomorph ggtree
comments: true
---

```{r setup, include=FALSE, message=FALSE}
# knitr settings
#knitr::opts_chunk$set(fig.path = "assets/Rfigs/", message=FALSE, comment=" ", fig.align='center')
#knitr::opts_knit$set(base.dir = "/Users/nunnlab/Desktop/GitHub/rgriff23.github.io/", base.url = "/")
knitr::opts_chunk$set(message=FALSE, comment=" ", cache=TRUE)

# load packages 
library(ape)
library(geiger)
library(geomorph)
library(ggtree)
```

## The ecomorphology of orbit orientation (Heesy 2005)

"Convergent orbits", or the tendancy for the orbits of the skull to face forwards, have long been included in the suite of characteristics that differentiate the first primates from other mammals of the early Cretaceous. Several theories have popularized the notion that orbit convergence was functionally important for early primates...

In recent years, the nocturnal visual predation (NVP) hypothesis has pulled out ahead of the other hypotheses in terms of widespread support. One study that has helped popularize NVP was Heesy's (2005) paper, "Ecomorphology of orbit orientation". Heesy compiled a comparative dataset on orbit orientation and the ecological variables of activity pattern (nocturnal = 1, other = 0), diet (insectivory = 1, other = 0), and substrate use (arboreal = 1, other = 0). Orbit orientation was captured with two angles, convergence and frontation, diagrammed below:

Heesy (2005) assessed the relationship between the ecological variables and orbit orientation using MANOVA, with orbit convergence and frontation as the response variable, and nocturnality, insectivory, and arboreality as predictor variables. This is the full model:

[convergence, frontation] ~ nocturnality + insectivory + arboreality

The results showed that only nocturnality and insectivory were significant, lending support to the NVP hypothesis. Since Heesy commendably published his data along with his paper, we can easily reproduce the main MANOVA analysis:

```{r post_2017-06_heesy-boxplots}
# read data
data <- read.csv("~/Dropbox/Duke/Semesters at Duke/2014 Fall/Fossils/Fossil final project/Data/HeesyData.csv", header=TRUE, row.names=1)

# manova
heesy.model <- manova(cbind(OrbitConvergence, Frontition) ~ NOCCODE+Fauncode+Arbcode, data=data)
summary(heesy.model)
```

In the next section, we will see how a more appropriate model that accounts for the evolutionary relationships among taxa will lead us to very different statistical conclusions.

## Problem of phylogenetic autocorrelation

Phylogenetic autocorrelation, also called phylogenetic pseudoreplication or phylogenetic non-independence, is a well-known problem in comparative evolutionary biology. The problem arises when researchers attempt to apply statistical methods that assume independent observations (e.g., linear regression) to evolutionary data that is not statistically independent. For example, a human, a chimpanzee, and a tuna cannot be considered 3 independent entities because a human and a chimpanzee are much more closely related to each other than they are to a tuna, thus they have had less time to evolve independently. Failure to account for phylogenetic autocorrelation in statistical models leads to elevated risk of Type I error, or false positives, because relationships that are driven by phylogenetic patterns may be incorrectly attributed to predictor variables in the model. 

The need to incorporate phylogenetic relationships into statistical models of evolution has spawned an entire subfield at the intersection of evolutionary biology and statistics: phylogenetic comparative methods (PCM). One of the most commonly used PCMs is phylogenetic generalized least squares (PGLS), which is simply a linear regression that incorporates a phylogenetic distance matrix into the variance-covariance structure of the model. In the following section, we will see how using PGLS to correct for phylogenetic autocorrelation in Heesy's (2005) regression models eliminates the significant associations between orbit orientation and ecological variables. 

## Reanalysis

If you want to follow along with my entire analysis, make sure you have the following R packages installed: 

```{r, eval=FALSE}
# install packages
install.packages(ape)
install.packages(geiger)
install.packages(geomorph)
install.packages(ggtree)
```

Next, import a phylogeny from GitHub. This is a trimmed down version of the mammal supertree published by [Bininda-Emonds et al. ()](). I have already done the work of cleaning of taxa labels and dropping the few taxa from Heesy's data that were not present in the Bininda-Emonds phylogeny, so taxa labels should match up perfectly between the tree and data. 

```{r}
# load package
library(ape)

# import phylogenetic tree
tree <- read.nexus("~/Dropbox/Duke/Semesters at Duke/2014 Fall/Fossils/Fossil final project/Data/HeesyTree.nexus")

# resolve polytomies
tree <- multi2di(tree)
```

We can perform a simple phylogenetic MANOVA using the `aov.phylo` function in the `geiger` package. This function does not take a `data` argument, and has the limitation of only allowing one predictor variable at a time.

```{r}
# load package
library(geiger)

# define multidimensional response variable
angles <- data[,c("OrbitConvergence","Frontition")]

# define univariate predictors (must be factors)
nocturnal <- as.factor(setNames(data$NOCCODE, row.names(data)))
insectivore <- as.factor(setNames(data$Fauncode, row.names(data)))
arboreal <- as.factor(setNames(data$Arbcode, row.names(data)))

# make reproducible
set.seed(23)

# activity pattern
mod1 <- aov.phylo(angles ~ nocturnal, tree)
print(attributes(mod1)$summary)

# diet
mod2 <- aov.phylo(angles ~ insectivore, phy=tree)
print(attributes(mod2)$summary)

# substrate
mod3 <- aov.phylo(angles ~ arboreal, phy=tree)
print(attributes(mod3)$summary)
```



```{r}
# load package
library("geomorph")

# subset data (no missing values allowed)
data2 <- data[,c("OrbitConvergence","Frontition","NOCCODE","Fauncode","Arbcode")]
names(data2) <- c("Convergence", "Frontition", "Nocturnal", "Insectivore", "Arboreal")
data2 <- data2[complete.cases(data2),]
angles2 <- data2[,1:2]
vars <- data2[,3:5]
droptax <- row.names(data)[!(row.names(data) %in% row.names(data2))]
tree2 <- multi2di(drop.tip(tree, droptax))

# create new 'geomorph data frame' with response, predictors, and tree
df <- geomorph.data.frame(angles2, vars, tree2)

# multivariate MANOVA with procD.pgls in geomorph
procD.pgls(angles2 ~ nocturnal + insectivore + arboreal, phy=tree2, data=df)

```

Clearly there is a strong phylogenetic pattern in the data, visualized below. 

```{r post_2017-06_heesy-phylogeny}
# load package
library(ggtree)
```

When we take this pattern into account in our statistical model, the relationships between ecological variables and orbit orientation are no longer statistically signficant. Thus, when analyzed properly, this comparative data does not provide statistical support for the NVP hypothesis. 

## Concluding remarks

It is important to keep in mind what these results do *not* tell us... specifically, these results do *not* imply that shifts in orbit orientation were *not* driven by the ecological variables in question. It could be that any or all of these variables played a role in directing the evolution of early primate orbits. Unfortunately, unless our data captures numerous instances of correlated shifts in orbit orientation and ecology, we are unlikely to find statistical associations between these variables after controlling for phylogenetic autocorrelation. Inferences about such singular or very rare events in evolutionary history may have to depend more on circumstantial rather than statistical evidence. 

That said, I think there is room to do more comparative statistical work on the evolution of orbit orientation. I see two major directions for advancing this project. 

-First is expanding the dataset. There is room for more complete sampling of extant taxa, and for the addition of fossils. It also would be good to include other aspects of skull morphology in the models, particularly the size of the prefrontal cortex, which has been [hypothesized]() to explain much of the variation in mammalian orbit orientation.

-Second is fitting more [sophisticated models]() that aim to detect shifts in the tempo or mode of evolution. For instance, it would be interesting to know if there is a statistically significant 'shift' in the mean orbit orientation at the base of the primate clade (I think the NVP hypothesis would predict a mean shift at the base of both the primates and the carnivores). 

These two directions are complementary, since adding more data ([particularly fossils]()) increases statistical power to detect deviations from gradual (Brownian) evolution.




